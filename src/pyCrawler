import json
from selenium import webdriver

ChromeDriverFile = ""

def OpenTargetUrl(subject, url):

    options = webdriver.ChromeOptions()
    options.add_argument('headless')
    #options.add_argument('window-size=1920x1080')
    #options.add_argument("disable-gpu")
    options.add_argument("user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36")

    driver = webdriver.Chrome(ChromeDriverFile, chrome_options=options)
    driver.get(url)
    driver.implicitly_wait(3)

    contents_list = driver.find_element_by_xpath('//*[@id="aNews_List"]/ul')
    contents = contents_list.find_elements_by_tag_name('li')

    for content in contents:
        print(content.text)


# 크롤링 타겟 설정
def MakeRequest(TargetCategoriesFile, TargetURL):
    with open(TargetCategoriesFile, 'r') as Target:
        categories = json.load(Target)

    for categories in categories["Categories"]:
        if categories["target"] == "enabled":
            url = TargetURL + str(categories["id"])
            subject = categories["subject"]

            print("url" + url)
            print("subject" + subject)

            OpenTargetUrl(subject, url)

# main function
if __name__ == "__main__":

    # 환경 설정 파일 로딩
    with open('../config/config.json', 'r') as configFile:
        config = json.load(configFile)

    ChromeDriverFile = config["LOCAL"]["ChromeDriverPath"] + "/" + config["DEFAULT"]["ChromeDriver"]

    TargetURL = config["DEFAULT"]["TargetUrl"]
    TargetCategoriesFile = config["LOCAL"]["ResourcePath"] + "/" + config["DEFAULT"]["ResourceFile"]

    MakeRequest(TargetCategoriesFile, TargetURL)
    
    
    
    